var ajaxTimeout=15;$(document).on("ready",(function(){device_ids=$.parseJSON(device_ids);var _=$("#progressbox");function C(_,n,O,E,e,o){o=o||1;i(_,e,$.i18n("BLOCK_CHECK_CONNECTION"),$.i18n("BLOCK_CHECK_CONNECTION_START_CHECK_TRY")+o,"info"),$.ajax({dataType:"json",url:_BASEURL_+"doAjax",data:{id:_,cmnd:"Status 2"},timeout:1e3*ajaxTimeout,custom:{callback:n},type:"post",success:function(L){console.log(L),L&&!L.ERROR?(L.WARNING&&i(_,e,$.i18n("BLOCK_CHECK_CONNECTION"),$.i18n("BLOCK_CHECK_CONNECTION_CHECK_ERROR_MSG")+L.WARNING,"error"),i(_,e,$.i18n("BLOCK_CHECK_CONNECTION"),$.i18n("BLOCK_CHECK_CONNECTION_CHECK_OK_VERSION")+L.StatusFWR.Version,"success"),this.custom.callback(O,E,e)):(i(_,e,$.i18n("BLOCK_CHECK_CONNECTION"),$.i18n("BLOCK_CHECK_CONNECTION_CHECK_NO_RESPONSE_MSG")+L.ERROR,"error"),o<3&&C(_,n,O,E,e,o+=1))},error:function(L){i(_,e,$.i18n("BLOCK_CHECK_CONNECTION"),$.i18n("BLOCK_CHECK_CONNECTION_CHECK_NO_RESPONSE_MSG"),"error"),o<3&&C(_,n,O,E,e,o+=1)}})}function n(_,C,n){var E="";E="MINIMAL"===C?$("#ota_minimal_firmware_url").val():$("#ota_new_firmware_url").val(),i(_,n,$.i18n("BLOCK_OTAURL"),$.i18n("BLOCK_OTAURL_SET_URL_FWTYPE")+C,"info"),i(_,n,$.i18n("BLOCK_OTAURL"),$.i18n("BLOCK_OTAURL_SET_URL_FWURL")+E,"info");var e="OtaUrl "+E;$.ajax({dataType:"json",url:_BASEURL_+"doAjax",data:{id:_,cmnd:e},timeout:1e3*ajaxTimeout,type:"post",success:function(E){console.log(E),E.WARNING&&i(_,n,$.i18n("BLOCK_OTAURL"),$.i18n("BLOCK_OTAURL_ERROR_MSG")+E.WARNING,"error"),i(_,1,$.i18n("BLOCK_OTAURL"),$.i18n("BLOCK_OTAURL_SUCCESS_FWTYPE")+C,"success"),function(_,C){i(_,C,$.i18n("BLOCK_UPDATE"),$.i18n("BLOCK_UPDATE_START"),"info");$.ajax({dataType:"json",url:_BASEURL_+"doAjax",data:{id:_,cmnd:"Upgrade 1"},type:"post",timeout:1e3*ajaxTimeout,success:function(n){console.log(n),n&&!n.ERROR?(n.WARNING?i(_,C,$.i18n("BLOCK_UPDATE"),$.i18n("BLOCK_UPDATE_ERROR_MSG")+n.WARNING,"error"):i(_,C,$.i18n("BLOCK_UPDATE"),$.i18n("BLOCK_UPDATE_SUCCESS"),"info"),function _(C,n,E){if(E>48)return void i(C,n,$.i18n("BLOCK_CHECK_UPDATE"),$.i18n("BLOCK_CHECK_UPDATE_ERROR_X_MIN"),"error");var e=60;E>1&&(e=30);i(C,n,$.i18n("BLOCK_CHECK_UPDATE"),$.i18n("BLOCK_CHECK_UPDATE_WAIT_X_SECONDS")+e,"info"),setTimeout((function(){$.ajax({dataType:"json",url:_BASEURL_+"doAjax",data:{id:C,cmnd:"Status 2"},timeout:1e3*ajaxTimeout,type:"post",success:function(e){console.log(e),e&&!e.ERROR?1==n?(i(C,n,$.i18n("BLOCK_CHECK_UPDATE"),$.i18n("BLOCK_CHECK_UPDATE_UPDATE_DONE"),"success"),O(C)):i(C,n,$.i18n("BLOCK_CHECK_UPDATE_DONE"),$.i18n("BLOCK_CHECK_UPDATE_DONE_MESSAGE"),"success"):(i(C,n,$.i18n("BLOCK_CHECK_UPDATE"),$.i18n("BLOCK_CHECK_UPDATE_STILL_UPDATING"),"info"),_(C,n,E+1))},error:function(O){i(C,n,$.i18n("BLOCK_CHECK_UPDATE"),$.i18n("BLOCK_CHECK_UPDATE_STILL_UPDATING"),"info"),_(C,n,E+1)}})}),1e3*e)}(_,C,1)):i(_,C,$.i18n("BLOCK_UPDATE"),$.i18n("BLOCK_UPDATE_CHECK_NO_RESPONSE_MSG"),"error")},error:function(n){i(_,C,$.i18n("BLOCK_UPDATE"),$.i18n("BLOCK_UPDATE_CHECK_NO_RESPONSE_MSG"),"error")}})}(_,n)},error:function(C){i(_,n,$.i18n("BLOCK_OTAURL"),$.i18n("BLOCK_OTAURL_CHECK_NO_RESPONSE_MSG"),"error")}})}function O(_){i(_,2,$.i18n("BLOCK_GLOBAL"),$.i18n("BLOCK_GLOBAL_START_STEP_2"),"info"),C(_,n,_,"NEW FW",2)}function i(C,n,O,i,E){var e=new Date,o="["+((e.getDate()<10?"0"+e.getDate():e.getDate())+"-"+(parseInt(e.getMonth())+1<10?"0"+(parseInt(e.getMonth())+1):parseInt(e.getMonth())+1)+"-"+e.getFullYear()+" "+(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds()))+"]";""!==C&&(o+="["+$.i18n("BLOCK_GLOBAL_ID")+"-"+C+"]"),""!==n&&(o+="["+$.i18n("BLOCK_GLOBAL_STEP")+"-"+n+"]"),""!==O&&(o+="["+O+"]"),o+=" "+i,_.append("<span class='"+E+"'>"+o+"</span>"),_.animate({scrollTop:_[0].scrollHeight},150)}i("","",$.i18n("BLOCK_GLOBAL"),$.i18n("BLOCK_GLOBAL_START"),"success"),$.each(device_ids,(function(_,E){i(E,1,$.i18n("BLOCK_GLOBAL"),$.i18n("BLOCK_GLOBAL_START_STEP_1"),"info"),""!=$("#ota_minimal_firmware_url").val()?C(E,n,E,"MINIMAL",1):(i(E,1,$.i18n("BLOCK_GLOBAL"),$.i18n("BLOCK_GLOBAL_SKIP_STEP_1_MINIMAL"),"info"),O(E))}))}));