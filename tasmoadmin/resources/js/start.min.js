function updateStatus(){$("#content .box_device:not(#all_off)").each((function(e,t){var a=$(t).data("device_ip"),i=$(t).data("device_id"),s=$(t).data("device_relais"),o=$(t).data("device_group");if(!$(t).hasClass("updating")){if(console.log("[Start][updateStatus]get status from "+$(t).data("device_ip")),"multi"===o&&s>1)return void console.log("[Start][updateStatus]skip multi "+$(t).data("device_ip"));$(t).addClass("updating"),Sonoff.getStatus(a,i,s,(function(e){if(!e||e.ERROR||e.WARNING||""===e||void 0===e||void 0!==e.statusText)if(console.log("ERROR => "+JSON.stringify(e)),"multi"===o)$('#device-list tbody tr[data-device_group="multi"][data-device_ip="'+a+'"]').each((function(e,t){$(t).addClass("error").find(".animated").removeClass("animated"),$(t).removeClass("updating");var a=$(t).find("img"),i=_RESOURCESURL_+"img/device_icons/"+a.data("icon")+"_error.png?v=160";a.attr("src",i)}));else{$(t).addClass("error").find(".animated").removeClass("animated"),$(t).removeClass("updating");i=$(t).find("img"),s=_RESOURCESURL_+"img/device_icons/"+i.data("icon")+"_error.png?v=160";i.attr("src",s)}else if("multi"===o)$('#content .box_device[data-device_group="multi"][data-device_ip="'+a+'"]').each((function(t,a){var i=$(a).find("img"),s=_RESOURCESURL_+"img/device_icons/"+i.data("icon")+"_%pw.png?v=160",o=$(a).data("device_relais"),n=Sonoff.parseDeviceStatus(e,o);console.log(n.toLowerCase()),s=s.replace("%pw",n.toLowerCase()),i.attr("src",s).parent().removeClass("animated"),updateBox($(a),e,n),$(a).removeClass("error").find(".animated").removeClass("animated"),$(a).removeClass("updating")}));else{var i=$(t).find("img"),s=_RESOURCESURL_+"img/device_icons/"+i.data("icon")+"_%pw.png?v=160",n=Sonoff.parseDeviceStatus(e,1);console.log("device_status",n),void 0!==n&&(s=s.replace("%pw",n.toLowerCase()),i.attr("src",s).parent().removeClass("animated"),console.log("$( box )",$(t)),"NONE"===n&&$(t).data("device_group","sensor")),updateBox($(t),e,n),$(t).removeClass("error").find(".animated").removeClass("animated"),$(t).removeClass("updating")}}))}}))}function deviceTools(){$("#content .box_device:not(#all_off)").on("click",(function(e){e.preventDefault();var t=$(this),a=t.data("device_ip"),i=t.data("device_id"),s=t.data("device_relais");"sensor"!==t.data("device_group")?$(this).hasClass("toggled")?console.log("[Start][updateStatus]is toggling "+$(box).data("device_ip")):($(this).addClass("toggled"),t.find("img").shake(3,5,500),Sonoff.toggle(a,i,s,(function(e){if(!e||e.ERROR||e.WARNING){t.addClass("error");i=t.find("img"),o=_RESOURCESURL_+"img/device_icons/"+i.data("icon")+"_error.png?v=160";i.attr("src",o).parent().removeClass("animated"),console.log("[Start][toggle]ERROR "+a+" => "+e.ERROR||"Unknown Error")}else{var i=t.find("img"),o=_RESOURCESURL_+"img/device_icons/"+i.data("icon")+"_%pw.png?v=160",n=Sonoff.parseDeviceStatus(e,s);void 0!==n&&(o=o.replace("%pw",n.toLowerCase()),i.attr("src",o)),i.parent().removeClass("animated"),t.removeClass("error")}$("#content .box_device").removeClass("toggled")}))):console.log("[Start][updateStatus]skip sensor "+$(box).data("device_ip"))})),$("#all_off").on("click",(function(e){e.preventDefault(),$("#content .box_device:not(#all_off)").each((function(e,t){var a=$(t).data("device_ip"),i=$(t).data("device_id"),s=$(t).data("device_relais"),o=$(t).data("device_group");console.log("[Start][updateStatus]get status from "+$(t).data("device_ip")),"multi"===o&&s>1?console.log("[Start][updateStatus]skip multi "+$(t).data("device_ip")):"sensor"!==o?Sonoff.off(a,i,s,(function(e){if(!e||e.ERROR||e.WARNING){$(t).addClass("error");i=device_box.find("img"),o=_RESOURCESURL_+"img/device_icons/"+i.data("icon")+"_error.png?v=160";i.attr("src",o).parent().removeClass("animated"),console.log("[Start][toggle]ERROR "+a+" => "+e.ERROR||"Unknown Error")}else{var i=$(t).find("img"),o=_RESOURCESURL_+"img/device_icons/"+i.data("icon")+"_%pw.png?v=160",n=Sonoff.parseDeviceStatus(e,s);void 0!==n&&(o=o.replace("%pw",n.toLowerCase()),i.attr("src",o)),i.parent().removeClass("animated"),$(t).removeClass("error")}})):console.log("[Start][updateStatus]skip sensor "+$(t).data("device_ip"))}))}))}function updateBox(e,t,a){var i=parseVersion(t.StatusFWR.Version);if(console.log("version => "+i),i>=510009)var s=t.StatusSTS.Wifi.RSSI,o=t.StatusSTS.Wifi.SSId,n=t.StatusSTS.Uptime;else s=t.StatusSTS.WLAN?t.StatusSTS.WLAN.RSSI:t.StatusSTS.Wifi.RSSI,o=t.StatusSTS.WLAN?t.StatusSTS.WLAN.SSID:t.StatusSTS.Wifi.SSId,n="undefined"!==t.StatusSTS.Laufzeit?t.StatusSTS.Laufzeit:t.StatusSTS.Uptime;var d=1,r=getTemp(t,", ");""!==r&&($(e).find(".info-"+d+" span").html(r).parent().removeClass("hidden"),d++);var l=getHumidity(t,", ");""!==l&&($(e).find(".info-"+d+" span").html(l).parent().removeClass("hidden"),d++);var S=getPressure(t,", ");""!==S&&($(e).find(".info-"+d+" span").html(S).parent().removeClass("hidden"),d++);var c=getSeaPressure(t,", ");""!==c&&($(e).find(".info-"+d+" span").html(c).parent().removeClass("hidden"),d++);var v=getDistance(t,", ");""!==v&&($(e).find(".info-"+d+" span").html(v).parent().removeClass("hidden"),d++);var u=getEnergyPower(t,", ");""!==u&&($(e).find(".info-"+d+" span").html(u).parent().removeClass("hidden"),d++);var p=getGas(t,", ");""!==p&&($(e).find(".info-"+d+" span").html(p).parent().removeClass("hidden"),d++);var f=t.idx?t.idx:"";""!==f&&($(e).find(".idx span").html(f),$("#device-list .idx").removeClass("hidden").show()),$(e).find(".version span").html(t.StatusFWR.Version),"ON"===a?$(e).find(".status").find("input").prop("checked","checked").parent().removeClass("error"):$(e).find(".status").find("input").removeProp("checked").parent().removeClass("error"),$(e).find(".rssi span").html(s+"%").attr("title",o),$(e).find(".runtime span").html("~"+n+"h"),$(e).find(".hostname span").html(void 0!==t.StatusNET.Hostname?t.StatusNET.Hostname:"?"),$(e).find(".mac span").html(void 0!==t.StatusNET.Mac?t.StatusNET.Mac:"?"),$(e).find(".mqtt span").html(void 0!==t.StatusMQT?"1":"0"),$(e).find(".poweronstate span").html(void 0!==t.Status.PowerOnState?t.Status.PowerOnState:"?"),$(e).find(".ledstate span").html(void 0!==t.Status.LedState?t.Status.LedState:"?"),$(e).find(".savedata span").html(void 0!==t.Status.SaveData?t.Status.SaveData:"?"),$(e).find(".sleep span").html(void 0!==t.StatusPRM.Sleep?t.StatusPRM.Sleep+"ms":"?"),$(e).find(".bootcount span").html(void 0!==t.StatusPRM.BootCount?t.StatusPRM.BootCount:"?"),$(e).find(".savecount span").html(void 0!==t.StatusPRM.SaveCount?t.StatusPRM.SaveCount:"?"),$(e).find(".log span").html((void 0!==t.StatusLOG.SerialLog?t.StatusLOG.SerialLog:"?")+"|"+(void 0!==t.StatusLOG.WebLog?t.StatusLOG.WebLog:"?")+"|"+(void 0!==t.StatusLOG.SysLog?t.StatusLOG.SysLog:"?")),$(e).find(".wificonfig span").html(void 0!==t.StatusNET.WifiConfig?t.StatusNET.WifiConfig:"?"),$(e).find(".vcc span").html(void 0!==t.StatusSTS.Vcc?t.StatusSTS.Vcc+"V":"?"),$(e).removeClass("updating")}$(document).on("ready",(function(){deviceTools(),updateStatus(),refreshtime?(console.log("[Global][Refreshtime]"+refreshtime+"ms"),setInterval((function(){updateStatus()}),refreshtime)):console.log("[Global][Refreshtime]Dont refresh")}));