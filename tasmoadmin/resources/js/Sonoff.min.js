var Sonoff=function(options){var vars={timeout:10},root=this;this.construct=function(t){$.extend(vars,t)},this.getStatus=function(t,o,e,a,i){e=e||1;doAjax(t,o,"Status 0",a,i)},this.getAllStatus=function(t,o){doAjaxAll(t,"Status 0",o)},this.updateConfig=function(t,o,e,a){doAjax(null,t,o=o+" "+e,a)},this.generic=function(t,o,e,a){doAjax(null,t,o=o+(e=void 0!==e?" "+e:""),a)},this.toggle=function(t,o,e,a){var i="Power"+(e=e||1)+" toggle";console.log("[Sonoff][toggle]["+t+"][Relais"+e+"] cmnd => "+i),doAjax(t,o,i,a)},this.off=function(t,o,e,a){var i="Power"+(e=e||1)+" 0";console.log("[Sonoff][toggle]["+t+"][Relais"+e+"] cmnd => "+i),doAjax(t,o,i,a)};var doAjax=function(t,o,e,a){t=t||o;$.ajax({dataType:"json",url:"index.php?doAjax",timeout:1e3*options.timeout,cache:!1,type:"post",async:!0,data:{id:o,cmnd:encodeURIComponent(e)},success:function(o){console.log("[Sonoff][doAjax]["+t+"] Got response from: "+e),o.WARNING&&alert(t+": "+o.WARNING),void 0!==a&&a(o)},error:function(t,o,e,i){void 0!==a&&a(t)}})},doAjaxAll=function(t,o,e){t=t||options.timeout;$.ajax({dataType:"json",url:"index.php?doAjaxAll",timeout:1e3*t,cache:!1,type:"post",data:{cmnd:encodeURIComponent(o)},success:function(t){console.log("[Sonoff][doAjaxAll] Got response from: "+o),t.WARNING&&alert(ip+": "+t.WARNING),void 0!==e&&e(t)},error:function(t,o,a,i){void 0!==e&&e(t)}})};this.parseDeviceStatus=function(data,device_relais){var device_status="NONE";return void 0!==data.StatusSTS?void 0!==device_relais&&void 0!==eval("data.StatusSTS.POWER"+device_relais)?device_status=void 0!==eval("data.StatusSTS.POWER"+device_relais+".STATE")?eval("data.StatusSTS.POWER"+device_relais+".STATE"):eval("data.StatusSTS.POWER"+device_relais):void 0!==data.StatusSTS.POWER&&(device_status=void 0!==data.StatusSTS.POWER.STATE?data.StatusSTS.POWER.STATE:data.StatusSTS.POWER):void 0!==device_relais&&void 0!==eval("data.POWER"+device_relais)?device_status=void 0!==eval("data.POWER"+device_relais+".STATE")?eval("data.POWER"+device_relais+".STATE"):eval("data.POWER"+device_relais):void 0!==data.POWER&&(device_status=void 0!==data.POWER.STATE?data.POWER.STATE:data.POWER),device_status},this.directAjax=function(t){$.ajax({url:t,timeout:1e3*options.timeout,cache:!1,success:function(t){},error:function(t,o,e,a){}})},this.setDeviceValue=function(t,o,e,a){$.ajax({dataType:"json",url:"index.php?doAjax",timeout:1e3*options.timeout,cache:!1,type:"post",data:{id:t,field:encodeURIComponent(o),newvalue:encodeURIComponent(e),target:"csv"},success:function(i){console.log("[Sonoff][doAjax]["+t+"] Response from: "+o+" => "+JSON.stringify(i)),console.log("[Sonoff][doAjax]["+t+"] Got response from: "+o+" => "+e),a.html(i.position)},error:function(t,o,e,a){console.log("ERROR setDeviceValue")}})},this.buildCmndUrl=function(t,o){var e="http://"+t+"/cm?cmnd="+(o=o.replace(" ","%20"));return e=encodeURIComponent(e)},this.construct(options)};