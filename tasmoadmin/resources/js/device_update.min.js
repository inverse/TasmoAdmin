var ajaxTimeout=15;$(document).on("ready",(function(){device_ids=$.parseJSON(device_ids);var _=$("#progressbox");function C(_,C,i){var E="";E="MINIMAL"===C?$("#ota_minimal_firmware_url").val():$("#ota_new_firmware_url").val(),O(_,i,$.i18n("BLOCK_OTAURL"),$.i18n("BLOCK_OTAURL_SET_URL_FWTYPE")+C,"info"),O(_,i,$.i18n("BLOCK_OTAURL"),$.i18n("BLOCK_OTAURL_SET_URL_FWURL")+E,"info");var e="OtaUrl "+E;$.ajax({dataType:"json",url:_BASEURL_+"doAjax",data:{id:_,cmnd:e},timeout:1e3*ajaxTimeout,type:"post",success:function(E){console.log(E),E.WARNING&&O(_,i,$.i18n("BLOCK_OTAURL"),$.i18n("BLOCK_OTAURL_ERROR_MSG")+E.WARNING,"error"),O(_,1,$.i18n("BLOCK_OTAURL"),$.i18n("BLOCK_OTAURL_SUCCESS_FWTYPE")+C,"success"),function(_,C){O(_,C,$.i18n("BLOCK_UPDATE"),$.i18n("BLOCK_UPDATE_START"),"info");$.ajax({dataType:"json",url:_BASEURL_+"doAjax",data:{id:_,cmnd:"Upgrade 1"},type:"post",timeout:1e3*ajaxTimeout,success:function(i){console.log(i),i&&!i.ERROR?(i.WARNING?O(_,C,$.i18n("BLOCK_UPDATE"),$.i18n("BLOCK_UPDATE_ERROR_MSG")+i.WARNING,"error"):O(_,C,$.i18n("BLOCK_UPDATE"),$.i18n("BLOCK_UPDATE_SUCCESS"),"info"),function _(C,i,E){if(E>5)return void O(C,i,$.i18n("BLOCK_CHECK_UPDATE"),$.i18n("BLOCK_CHECK_UPDATE_ERROR_X_MIN"),"error");var e=60;E>1&&(e=30);O(C,i,$.i18n("BLOCK_CHECK_UPDATE"),$.i18n("BLOCK_CHECK_UPDATE_WAIT_X_SECONDS")+e,"info"),setTimeout((function(){$.ajax({dataType:"json",url:_BASEURL_+"doAjax",data:{id:C,cmnd:"Status 2"},timeout:1e3*ajaxTimeout,type:"post",success:function(e){console.log(e),e&&!e.ERROR?1==i?(O(C,i,$.i18n("BLOCK_CHECK_UPDATE"),$.i18n("BLOCK_CHECK_UPDATE_UPDATE_DONE"),"success"),n(C)):e.StatusFWR.Version.indexOf("minimal")>=0?(O(C,i,$.i18n("BLOCK_CHECK_UPDATE"),$.i18n("MINIMAL IS INSTALLED NOW, WAIT FOR MAIN FW!"),"info"),_(C,i,1)):O(C,i,$.i18n("BLOCK_CHECK_UPDATE_DONE"),$.i18n("BLOCK_CHECK_UPDATE_DONE_MESSAGE"),"success"):(O(C,i,$.i18n("BLOCK_CHECK_UPDATE"),$.i18n("BLOCK_CHECK_UPDATE_STILL_UPDATING"),"info"),_(C,i,E+1))},error:function(n){O(C,i,$.i18n("BLOCK_CHECK_UPDATE"),$.i18n("BLOCK_CHECK_UPDATE_STILL_UPDATING"),"info"),_(C,i,E+1)}})}),1e3*e)}(_,C,1)):O(_,C,$.i18n("BLOCK_UPDATE"),$.i18n("BLOCK_UPDATE_CHECK_NO_RESPONSE_MSG"),"error")},error:function(n){O(_,C,$.i18n("BLOCK_UPDATE"),$.i18n("BLOCK_UPDATE_CHECK_NO_RESPONSE_MSG"),"error")}})}(_,i)},error:function(C){O(_,i,$.i18n("BLOCK_OTAURL"),$.i18n("BLOCK_OTAURL_CHECK_NO_RESPONSE_MSG"),"error")}})}function n(_,n){O(n,2,$.i18n("BLOCK_GLOBAL"),$.i18n("BLOCK_GLOBAL_START_STEP_2"),"info"),function _(C,n,i,E,e,o){o=o||1,O(C,e,$.i18n("BLOCK_CHECK_CONNECTION"),$.i18n("BLOCK_CHECK_CONNECTION_START_CHECK_TRY")+o,"info"),$.ajax({dataType:"json",url:_BASEURL_+"doAjax",data:{id:C,cmnd:"Status 2"},timeout:1e3*ajaxTimeout,custom:{callback:n},type:"post",success:function(t){console.log(t),t&&!t.ERROR?(t.WARNING&&O(C,e,$.i18n("BLOCK_CHECK_CONNECTION"),$.i18n("BLOCK_CHECK_CONNECTION_CHECK_ERROR_MSG")+t.WARNING,"error"),O(C,e,$.i18n("BLOCK_CHECK_CONNECTION"),$.i18n("BLOCK_CHECK_CONNECTION_CHECK_OK_VERSION")+t.StatusFWR.Version,"success"),this.custom.callback(i,E,e)):(O(C,e,$.i18n("BLOCK_CHECK_CONNECTION"),$.i18n("BLOCK_CHECK_CONNECTION_CHECK_NO_RESPONSE_MSG")+t.ERROR,"error"),o<3&&_(C,n,i,E,e,o+=1))},error:function(t){O(C,e,$.i18n("BLOCK_CHECK_CONNECTION"),$.i18n("BLOCK_CHECK_CONNECTION_CHECK_NO_RESPONSE_MSG"),"error"),o<3&&_(C,n,i,E,e,o+=1)}})}(n,C,n,"NEW FW",2)}function O(C,n,O,i,E){var e=new Date,o="["+((e.getDate()<10?"0"+e.getDate():e.getDate())+"-"+(parseInt(e.getMonth())+1<10?"0"+(parseInt(e.getMonth())+1):parseInt(e.getMonth())+1)+"-"+e.getFullYear()+" "+(e.getHours()<10?"0"+e.getHours():e.getHours())+":"+(e.getMinutes()<10?"0"+e.getMinutes():e.getMinutes())+":"+(e.getSeconds()<10?"0"+e.getSeconds():e.getSeconds()))+"]";""!==C&&(o+="["+$.i18n("BLOCK_GLOBAL_ID")+"-"+C+"]"),""!==n&&(o+="["+$.i18n("BLOCK_GLOBAL_STEP")+"-"+n+"]"),""!==O&&(o+="["+O+"]"),o+=" "+i,_.append("<span class='"+E+"'>"+o+"</span>"),_.animate({scrollTop:_[0].scrollHeight},150)}O("","",$.i18n("BLOCK_GLOBAL"),$.i18n("BLOCK_GLOBAL_START"),"success"),$.each(device_ids,n)}));