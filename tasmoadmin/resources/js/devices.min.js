function initCommandHelper(){$(".showCommandInput").on("click",(function(t){$(this).toggleClass("btn-secondary").toggleClass("btn-primary"),$(".command-hidden").toggleClass("d-none"),$(".cmd_cb").toggleClass("d-none").find("input").prop("checked",!1),$(".cmdContainer ").removeClass("has-error"),$(".cmdContainer ").find("input").val(""),$(".cmdContainer ").find("#commandInputError").html("")})),$(".cmdContainer ").find("input").keypress((function(t){13==t.which&&$(".sendCommand").click()})),$(".select_all").change((function(){var t=this.checked;$(".device_checkbox").each((function(){this.checked=t})),$(".select_all").each((function(){this.checked=t}))})),$(".device_checkbox").change((function(){0==this.checked&&$(".select_all").each((function(){this.checked=!1})),$(".device_checkbox:checked").length==$(".device_checkbox").length&&$(".select_all").each((function(){this.checked=!0}))})),$(".sendCommand").on("click",(function(t){$(this).parent().parent().removeClass("has-error").find("#commandInputError").addClass("d-none").html("");var e=$.map($(".cmd_cb:not(.link ) input:not(.select_all):checked"),(function(t,e){return new Array($(t).val())}));if(0===e.length)return $(this).parent().parent().addClass("has-error").find("#commandInputError").removeClass("d-none").html($.i18n("ERROR_COMMAND_NO_DEVICE_SELECTED")),!1;var a=$(this).parent().parent().find(".commandInput").val();if(""===a)return $(this).parent().parent().addClass("has-error").find("#commandInputError").removeClass("d-none").html($.i18n("ERROR_PLS_ENTER_COMMAND")),!1;$.each(e,(function(t,e){console.log(e),Sonoff.generic(e,a,void 0,(function(t){console.log(t);var a=$("[data-device_id="+e+"]:first").find(".device_name a").text().trim();$("#commandInputError").append("ID "+e+" ("+a+") => "+JSON.stringify(t)+"<br/>")}))})),$(this).parent().parent().find("#commandInputError").removeClass("d-none").append($.i18n("SUCCESS_COMMAND_SEND")+"</br>")}))}function updateStatus(){$("#device-list tbody tr").each((function(t,e){var a=$(e).data("device_ip"),s=$(e).data("device_id"),i=$(e).data("device_relais"),o=$(e).data("device_group");if($(e).hasClass("updating"))console.log("[Devices][updateStatus]SKIP get status from "+$(e).data("device_ip"));else{if(console.log("[Devices][updateStatus]get status from "+$(e).data("device_ip")),$(e).addClass("updating"),"multi"===o&&i>1)return void console.log("[Devices][updateStatus]SKIP multi "+$(e).data("device_ip"));Sonoff.getStatus(a,s,i,(function(t){if(!t||t.ERROR||t.WARNING||""===t||void 0===t||void 0!==t.statusText)console.log("ERROR => "+JSON.stringify(t)),"multi"===o?$('#device-list tbody tr[data-device_group="multi"][data-device_ip="'+a+'"]').each((function(t,e){$(e).find(".status").find("input").parent().addClass("error"),$(e).find("td").each((function(t,e){$(e).find(".loader").length>0&&$(e).find("span").html("-")})),$(e).removeClass("updating")})):($(e).find(".status").find("input").parent().addClass("error"),$(e).removeClass("updating"));else if("multi"===o)$('#device-list tbody tr[data-device_group="multi"][data-device_ip="'+a+'"]').each((function(e,a){var s=$(a).data("device_relais"),i=Sonoff.parseDeviceStatus(t,s);updateRow($(a),t,i),$(a).removeClass("updating")}));else{var s=Sonoff.parseDeviceStatus(t,i);console.log(s),updateRow($(e),t,s)}}))}}))}function updateAllStatus(){var t=$("#device-list");if(t.hasClass("updating"))console.log("[Devices][updateAllStatus]SKIP");else{t.addClass("updating"),console.log("[Devices][updateAllStatus]START");var e=15*t.find("tbody tr").length;Sonoff.getAllStatus(e,(function(e){t.find("tbody tr").each((function(t,a){var s=$(a).data("device_id"),i=$(a).data("device_relais"),o=($(a).data("device_group"),e[s]||void 0);if(void 0===o||$.isEmptyObject(o)||o.ERROR||o.WARNING||""===o||void 0!==o.statusText){console.log("[LIST][updateAllStatus]["+s+"][ERROR] DATA => "+JSON.stringify(o)),$(a).hasClass("toggled")?$(a).removeClass("toggled"):$(a).find(".status").find("input").parent().addClass("error");var n=$.i18n("ERROR");void 0!==o?void 0!==o.ERROR?n=o.ERROR:void 0!==o.WARNING?n=o.WARNING:void 0!==o.statusText&&(n=o.statusText):n="data is empty",$(a).attr("data-original-title",n).attr("data-toggle","tooltip").tooltip({html:!0,delay:700}),$(a).find("td").each((function(t,e){$(e).find(".loader").length>0&&$(e).find("span").html("-")}))}else{console.log("[LIST][updateAllStatus]["+s+"]MSG => "+JSON.stringify(o));var d=Sonoff.parseDeviceStatus(o,i);$(a).removeAttr("data-original-title").removeAttr("data-toggle"),updateRow($(a),o,d),$(a).find(".status").find("input").parent().removeClass("error")}})),t.removeClass("updating")}))}}function deviceTools(){$("#device-list tbody tr td.status").on("click",(function(t){t.preventDefault();var e=$(this),a=$(this).closest("tr").data("device_ip"),s=$(this).closest("tr").data("device_id"),i=$(this).closest("tr").data("device_relais");e.find("input").prop("checked")?e.find("input").removeProp("checked"):e.find("input").prop("checked","checked"),$(this).closest("tr").addClass("toggled"),Sonoff.toggle(a,s,i,(function(t){if(!t||t.ERROR||t.WARNING)e.find("input").parent().addClass("error");else Sonoff.parseDeviceStatus(t,i)}))})),$("#deleteDeviceModal").on("show.bs.modal",(function(t){var e=$(this),a=$(t.relatedTarget);console.log(e.find(".btn-ok")),e.find(".btn-ok").attr("href",a.attr("href"));var s=a.data("dialog-text");e.find(".modal-body").html(s)})),$("#device-list tbody tr td a.restart-device").on("click",(function(t){t.preventDefault();var e=$(this).closest("tr").data("device_id");Sonoff.generic(e,"Restart",1)})),$(document).on("dblclick",".dblcEdit span",(function(){oriVal=$(this).text().toString().trim(),$(this).text("").addClass("dont-update");var t=10*oriVal.toString().length+20;input=$("<input class='dblEdit-Input form-control' type='text' style='width: "+t+"px; padding: 3px;'>"),input.appendTo($(this)).focus()})),$(document).on("focusout keypress",".dblEdit-Input",(function(t){if("keypress"!==t.type||13===t.which)if(""!==input.val()){var e=input.val(),a=$(this).closest("tr").data("device_id"),s=$(this).closest("td").data("target")||"device",i=$(this).closest("td").data("cmnd")||"",o=$(this).closest("td").data("field")||"";$(this).hide();var n=$(this).parent();$(this).parent().removeClass("dont-update").html($.i18n("TEXT_LOADING")).removeClass("dont-update"),"device"==s?Sonoff.updateConfig(a,i,e,updateStatus):"csv"==s&&Sonoff.setDeviceValue(a,o,e,n)}else $(this).parent().removeClass("dont-update").text(oriVal)}))}function updateRow(t,e,a){var s="n/A";if(void 0!==e.StatusFWR&&(s=parseVersion(e.StatusFWR.Version)),s>=510009)var i=e.StatusSTS.Wifi.RSSI,o=e.StatusSTS.Wifi.SSId,n=e.StatusSTS.Uptime;else i=e.StatusSTS.WLAN?e.StatusSTS.WLAN.RSSI:e.StatusSTS.Wifi.RSSI,o=e.StatusSTS.WLAN?e.StatusSTS.WLAN.SSID:e.StatusSTS.Wifi.SSId,n=e.StatusSTS.Laufzeit?e.StatusSTS.Laufzeit:e.StatusSTS.Uptime;var d=getEnergyPower(e);""!==d&&($(t).find(".energyPower span").html(d),$("#device-list .energyPower").removeClass("hidden"));var r=getTemp(e);""!==r&&($(t).find(".temp span").html(r),$("#device-list .temp").removeClass("hidden"));var l=getHumidity(e);""!==l&&($(t).find(".humidity span").html(l),$("#device-list .humidity").removeClass("hidden"));var c=getPressure(e);""!==c&&($(t).find(".pressure span").html(c),$("#device-list .pressure").removeClass("hidden"));var u=getSeaPressure(e);""!==u&&($(t).find(".seapressure span").html(u),$("#device-list .seapressure").removeClass("hidden"));var p=getDistance(e);""!==p&&($(t).find(".distance span").html(p),$("#device-list .distance").removeClass("hidden"));var h=getGas(e);""!==h&&($(t).find(".gas span").html(h),$("#device-list .gas").removeClass("hidden"));var f=e.idx?e.idx:"";""!==f&&($(t).find(".idx span").html(f),$("#device-list .idx").removeClass("hidden").show()),$(t).find(".version span").html(e.StatusFWR.Version),$(t).hasClass("toggled")?$(t).removeClass("toggled"):"ON"===a?$(t).find(".status").find("input").prop("checked","checked").parent().removeClass("error"):"NONE"===a?($(t).find(".status").find("input").removeProp("checked").parent().removeClass("error"),$(t).find(".status").find("label").addClass("d-none")):$(t).find(".status").find("input").removeProp("checked").parent().removeClass("error"),$(t).find(".rssi span").html(i+"%").attr("data-original-title",o).attr("data-toggle","tooltip").tooltip({html:!0,delay:700});var v=void 0!==e.StatusPRM.StartupDateTimeUtc?e.StatusPRM.StartupDateTimeUtc:void 0!==e.StatusPRM.StartupUTC?e.StatusPRM.StartupUTC:"";if(""!==v){var m=v+"Z".replace(/-/g,"/");m=new Date(m);var S=(new Date-m)/1e3,g=Math.floor(S/86400),C=Math.floor((S-86400*g)/3600),R=Math.floor((S-86400*g-3600*C)/60),_=Math.floor(S-86400*g-3600*C-60*R);n=(0!==g?g+$.i18n("UPTIME_SHORT_DAY"):"")+" "+(0!==C||0!==g?C+$.i18n("UPTIME_SHORT_HOUR"):"")+" "+(0!==R||0!==C||0!==g?R+$.i18n("UPTIME_SHORT_MIN"):"")+" "+(0!==_||0!==R||0!==C?_+$.i18n("UPTIME_SHORT_SEC"):"-"),n=$.trim(n),$(t).find(".runtime span").html(n).attr("data-original-title",m.toLocaleString($("html").attr("lang")+"-"+$("html").attr("lang").toUpperCase(),{hour12:!1})).attr("data-toggle","tooltip").tooltip({html:!0,delay:700})}else console.log(n),$(t).find(".runtime span").html(n+"h");$(t).find(".hostname span").hasClass("dont-update")||$(t).find(".hostname span").html(void 0!==e.StatusNET.Hostname?e.StatusNET.Hostname:"?"),$(t).find(".mac span").hasClass("dont-update")||$(t).find(".mac span").html(void 0!==e.StatusNET.Mac?e.StatusNET.Mac:"?"),$(t).find(".mqtt span").hasClass("dont-update")||$(t).find(".mqtt span").html(void 0!==e.StatusMQT?"1":"0"),$(t).find(".poweronstate span").hasClass("dont-update")||$(t).find(".poweronstate span").html(void 0!==e.Status.PowerOnState?e.Status.PowerOnState:"?"),$(t).find(".ledstate span").hasClass("dont-update")||$(t).find(".ledstate span").html(void 0!==e.Status.LedState?e.Status.LedState:"?"),$(t).find(".savedata span").hasClass("dont-update")||$(t).find(".savedata span").html(void 0!==e.Status.SaveData?e.Status.SaveData:"?"),$(t).find(".sleep span").hasClass("dont-update")||$(t).find(".sleep span").html(void 0!==e.StatusPRM.Sleep?e.StatusPRM.Sleep+"ms":"?"),$(t).find(".bootcount span").html(void 0!==e.StatusPRM.BootCount?e.StatusPRM.BootCount:"?"),$(t).find(".savecount span").html(void 0!==e.StatusPRM.SaveCount?e.StatusPRM.SaveCount:"?"),$(t).find(".log span").html((void 0!==e.StatusLOG.SerialLog?e.StatusLOG.SerialLog:"?")+"|"+(void 0!==e.StatusLOG.WebLog?e.StatusLOG.WebLog:"?")+"|"+(void 0!==e.StatusLOG.SysLog?e.StatusLOG.SysLog:"?")),$(t).find(".wificonfig span").hasClass("dont-update")||$(t).find(".wificonfig span").html(void 0!==e.StatusNET.WifiConfig?e.StatusNET.WifiConfig:"?"),$(t).find(".vcc span").html(void 0!==e.StatusSTS.Vcc?e.StatusSTS.Vcc+"V":"?"),$(".doubleScroll-scroll").css({width:$("#device-list").width()}).parent().trigger("resize"),$(t).removeClass("updating")}$(document).on("ready",(function(){deviceTools(),updateAllStatus(),initCommandHelper(),$(".showmore").on("change",(function(t){$(this).prop("checked")?($(".showmore").prop("checked",!0),Cookies.set("devices_show_more","1"),$("#device-list .more:not(.hidden)").show(),$("label[for="+$(".showmore").attr("id")+"]").removeClass("btn-secondary").addClass("btn-primary")):($(".showmore").prop("checked",!1),Cookies.set("devices_show_more","0"),$("#device-list .more").hide(),$("label[for="+$(".showmore").attr("id")+"]").removeClass("btn-primary").addClass("btn-secondary")),$(".doubleScroll-scroll").css({width:$("#device-list").width()}).parent().trigger("resize")})),void 0!==Cookies.get("devices_show_more")&&"1"==Cookies.get("devices_show_more")&&($(".showmore").prop("checked",!0),$("#device-list .more:not(.hidden)").show(),$("label[for="+$(".showmore").attr("id")+"]").removeClass("btn-secondary").addClass("btn-primary"),$(".doubleScroll-scroll").css({width:$("#device-list").width()}).parent().trigger("resize")),$(".table-responsive").attachDragger(),refreshtime?(console.log("[Global][Refreshtime]"+refreshtime+"ms"),setInterval((function(){console.log("[Global][Refreshtime] updateStatus now"),updateStatus()}),refreshtime)):console.log("[Global][Refreshtime] "+$.i18n("NO_REFRESH"))}));