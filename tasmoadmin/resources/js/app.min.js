var Sonoff,refreshtime=!1,nightmode=!1;function notifyMe(t,e){""!==(e=e||"")&&(e=" - "+e);if("Notification"in window)if("granted"===Notification.permission){var S=new Notification("TasmoAdmin"+e,{body:t,icon:"./resources/img/favicons/apple-icon-180x180.png"});setTimeout(S.close.bind(S),3e3)}else"denied"!==Notification.permission&&Notification.requestPermission((function(S){if("granted"===S){var s=new Notification("TasmoAdmin"+e,{body:t});setTimeout(s.close.bind(s),3e3)}}))}$(document).on("ready",(function(){var t=$("html").attr("lang"),e=_BASEURL_+"tmp/cache/i18n/json_i18n_"+t+".cache.json";$.ajax({dataType:"json",url:e,async:!1,success:function(t){$.i18n().load(t)}}),checkNightmode(nightmodeconfig),checkForUpdate(!0),$(".double-scroll").doubleScroll({contentElement:"#device-list",scrollCss:{"overflow-x":"auto","overflow-y":"hidden"},contentCss:{"overflow-x":"auto","overflow-y":"hidden"},onlyIfScroll:!0,resetOnWindowResize:!0,timeToWaitForResize:1}),Sonoff=new Sonoff({timeout:15}),$('[title][title!=""]').tooltip({html:!0,delay:300}),$(".custom-file-input").on("change",(function(){var t=$(this).val();t=(t=t.replace(/^.*\\/,"")).match(/[^\\/]*$/)[0],$(this).next().html(t)})),$("a.reload").on("click",(function(t){t.preventDefault(),window.location.href=window.location.href})),$("#versionHolder").on("click",(function(t){t.preventDefault(),$(this).hasClass("update-now")||"0"===$("#versionHolder").data("update-check")?window.location.href=_BASEURL_+"selfupdate":checkForUpdate(!1)}));"none"!==$("#content").data("refreshtime")&&(refreshtime=1e3*$("#content").data("refreshtime")),$('input[type="number"]').keydown((function(t){-1!==$.inArray(t.keyCode,[46,8,9,27,13,110,190])||65===t.keyCode&&(!0===t.ctrlKey||!0===t.metaKey)||t.keyCode>=35&&t.keyCode<=40||(t.shiftKey||t.keyCode<48||t.keyCode>57)&&(t.keyCode<96||t.keyCode>105)&&t.preventDefault()})),$("select#language-switch").on("change",(function(t,e){$("option:selected",this);var S=this.value,s=window.location.toString()+"/"+S+"/";s=s.replace(/([^:]\/)\/+/g,"$1"),window.location.href=s})),$("body").on("click",".show-hide-password",(function(t){let e=$(this).closest(".input-group").find("input");"password"===e.attr("type")?(e.attr("type","text"),$(this).find("i").addClass("fa-eye-slash")):($(this).find("i").removeClass("fa-eye-slash"),e.attr("type","password"))}))})),$.fn.attachDragger=function(){var t,e,S,s=!1;$($(this).selector).on("mousedown mouseup mousemove",(function(a){"mousedown"!==a.type||$(a.target).hasClass("tablesaw-cell-content")||(s=!0,t=[a.clientX,a.clientY],$(".tablesaw-cell-content").addClass("dontselect")),"mouseup"===a.type&&(s=!1,$(".tablesaw-cell-content").removeClass("dontselect")),"mousemove"===a.type&&!0===s&&(e=[a.clientX,a.clientY],S=[e[0]-t[0],e[1]-t[1]],$(this).scrollLeft($(this).scrollLeft()-S[0]),$(this).scrollTop($(this).scrollTop()-S[1]),t=[a.clientX,a.clientY])})),$(window).on("mouseup",(function(){s=!1,$(".tablesaw-cell-content").removeClass("dontselect")}))};var parseVersion=function(t){var e=(t=t.replace("-minimal","").replace(/\./g,"")).slice(-1);return isNaN(e)?t=t.replace(e,e.charCodeAt(0)-97<10?"0"+(e.charCodeAt(0)-97):e.charCodeAt(0)-97):t+="00",t};function getTemp(t,e){var S=[];e=e||"<br/>";return null==t.StatusSNS.TempUnit&&(t.StatusSNS.TempUnit="F"),void 0!==t.StatusSNS.DS18B20&&S.push(t.StatusSNS.DS18B20.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.DS18x20&&(void 0!==t.StatusSNS.DS18x20.DS1&&S.push(t.StatusSNS.DS18x20.DS1.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.DS18x20.DS2&&S.push(t.StatusSNS.DS18x20.DS2.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.DS18x20.DS3&&S.push(t.StatusSNS.DS18x20.DS3.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.DS18x20.DS4&&S.push(t.StatusSNS.DS18x20.DS4.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.DS18x20.DS5&&S.push(t.StatusSNS.DS18x20.DS5.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.DS18x20.DS6&&S.push(t.StatusSNS.DS18x20.DS6.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.DS18x20.DS7&&S.push(t.StatusSNS.DS18x20.DS7.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.DS18x20.DS8&&S.push(t.StatusSNS.DS18x20.DS8.Temperature+"°"+t.StatusSNS.TempUnit)),void 0!==t.StatusSNS["DS18B20-1"]&&S.push(t.StatusSNS["DS18B20-1"].Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS["DS18B20-2"]&&S.push(t.StatusSNS["DS18B20-2"].Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS["DS18B20-3"]&&S.push(t.StatusSNS["DS18B20-3"].Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS["DS18B20-4"]&&S.push(t.StatusSNS["DS18B20-4"].Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS["DS18B20-5"]&&S.push(t.StatusSNS["DS18B20-5"].Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS["DS18B20-6"]&&S.push(t.StatusSNS["DS18B20-6"].Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS["DS18B20-7"]&&S.push(t.StatusSNS["DS18B20-7"].Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS["DS18B20-8"]&&S.push(t.StatusSNS["DS18B20-8"].Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.DHT11&&S.push(t.StatusSNS.DHT11.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.AM2301&&S.push(t.StatusSNS.AM2301.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.SHT3X&&S.push(t.StatusSNS.SHT3X.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS["SHT3X-0x45"]&&S.push(t.StatusSNS["SHT3X-0x45"].Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.BMP280&&S.push(t.StatusSNS.BMP280.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.BME680&&S.push(t.StatusSNS.BME680.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.BME280&&S.push(t.StatusSNS.BME280.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS["BME280-76"]&&S.push(t.StatusSNS["BME280-76"].Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS["BME280-77"]&&S.push(t.StatusSNS["BME280-77"].Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.SI7021&&S.push(t.StatusSNS.SI7021.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.HTU21&&S.push(t.StatusSNS.HTU21.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.BMP180&&S.push(t.StatusSNS.BMP180.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.LM75AD&&S.push(t.StatusSNS.LM75AD.Temperature+"°"+t.StatusSNS.TempUnit),void 0!==t.StatusSNS.MAX31855&&S.push(t.StatusSNS.MAX31855.ProbeTemperature+"°"+t.StatusSNS.TempUnit),S.join(e)}function getHumidity(t,e){var S=[];e=e||"<br/>";return void 0!==t.StatusSNS.AM2301&&void 0!==t.StatusSNS.AM2301.Humidity&&S.push(t.StatusSNS.AM2301.Humidity+"%"),void 0!==t.StatusSNS.BME280&&void 0!==t.StatusSNS.BME280.Humidity&&S.push(t.StatusSNS.BME280.Humidity+"%"),void 0!==t.StatusSNS["BME280-76"]&&void 0!==t.StatusSNS["BME280-76"].Humidity&&S.push(t.StatusSNS["BME280-76"].Humidity+"%"),void 0!==t.StatusSNS["BME280-77"]&&void 0!==t.StatusSNS["BME280-77"].Humidity&&S.push(t.StatusSNS["BME280-77"].Humidity+"%"),void 0!==t.StatusSNS.BME680&&void 0!==t.StatusSNS.BME680.Humidity&&S.push(t.StatusSNS.BME680.Humidity+"%"),void 0!==t.StatusSNS.DHT11&&void 0!==t.StatusSNS.DHT11.Humidity&&S.push(t.StatusSNS.DHT11.Humidity+"%"),void 0!==t.StatusSNS.SHT3X&&void 0!==t.StatusSNS.SHT3X.Humidity&&S.push(t.StatusSNS.SHT3X.Humidity+"%"),void 0!==t.StatusSNS["SHT3X-0x45"]&&void 0!==t.StatusSNS["SHT3X-0x45"].Humidity&&S.push(t.StatusSNS["SHT3X-0x45"].Humidity+"%"),void 0!==t.StatusSNS.SI7021&&void 0!==t.StatusSNS.SI7021.Humidity&&S.push(t.StatusSNS.SI7021.Humidity+"%"),void 0!==t.StatusSNS.HTU21&&void 0!==t.StatusSNS.HTU21.Humidity&&S.push(t.StatusSNS.HTU21.Humidity+"%"),S.join(e)}function getPressure(t,e){var S=[];e=e||"<br/>";return void 0!==t.StatusSNS.BME280&&void 0!==t.StatusSNS.BME280.Pressure&&S.push(t.StatusSNS.BME280.Pressure+"&nbsp;hPa"),void 0!==t.StatusSNS["BME280-76"]&&void 0!==t.StatusSNS["BME280-76"].Pressure&&S.push(t.StatusSNS["BME280-76"].Pressure+"&nbsp;hPa"),void 0!==t.StatusSNS["BME280-77"]&&void 0!==t.StatusSNS["BME280-77"].Pressure&&S.push(t.StatusSNS["BME280-77"].Pressure+"&nbsp;hPa"),void 0!==t.StatusSNS.BMP280&&void 0!==t.StatusSNS.BMP280.Pressure&&S.push(t.StatusSNS.BMP280.Pressure+"&nbsp;hPa"),void 0!==t.StatusSNS.BME680&&void 0!==t.StatusSNS.BME680.Pressure&&S.push(t.StatusSNS.BME680.Pressure+"&nbsp;hPa"),void 0!==t.StatusSNS.BMP180&&void 0!==t.StatusSNS.BMP180.Pressure&&S.push(t.StatusSNS.BMP180.Pressure+"&nbsp;hPa"),S.join(e)}function getSeaPressure(t,e){var S=[];e=e||"<br/>";return void 0!==t.StatusSNS.BMP180&&void 0!==t.StatusSNS.BMP180.SeaPressure&&S.push(t.StatusSNS.BMP180.SeaPressure+"&nbsp;hPa"),S.join(e)}function getDistance(t,e){var S=[];e=e||"<br/>";return void 0!==t.StatusSNS.SR04&&void 0!==t.StatusSNS.SR04.Distance&&S.push(t.StatusSNS.SR04.Distance+"cm"),S.join(e)}function getEnergyPower(t,e){var S=[];e=e||"<br/>";if(void 0!==t.StatusSNS.ENERGY){if(void 0!==t.StatusSNS.ENERGY.Power&&S.push(t.StatusSNS.ENERGY.Power+"W"),void 0!==t.StatusSNS.ENERGY.Today){var s=t.StatusSNS.ENERGY.Today;void 0!==t.StatusSNS.ENERGY.Yesterday&&(s+="/"+t.StatusSNS.ENERGY.Yesterday),S.push(s+"kWh")}void 0!==t.StatusSNS.ENERGY.Current&&S.push(t.StatusSNS.ENERGY.Current+"A")}return S.join(e)}function getGas(t,e){var S=[];e=e||"<br/>";return void 0!==t.StatusSNS.BME680&&void 0!==t.StatusSNS.BME680.Gas&&S.push(t.StatusSNS.BME680.Gas+"kOhm"),S.join(e)}function checkNightmode(t){console.log("[APP][checkNightmode] Start");t=t||"auto";var e=(new Date).getHours();"disable"===t?($("body").removeClass("nightmode"),console.log("[APP][checkNightmode] disabled")):"auto"===t?(console.log("[APP][checkNightmode] check time"),e>=18||e<=8?($("body").addClass("nightmode"),console.log("[APP][checkNightmode] its night")):($("body").removeClass("nightmode"),console.log("[APP][checkNightmode] its day")),setTimeout((function(){checkNightmode(t)}),9e5)):"always"===t&&(console.log("[APP][checkNightmode] always"),$("body").addClass("nightmode")),$("body").hasClass("nightmode")&&(nightmode=!0)}function checkForUpdate(t){if("0"===$("#versionHolder").data("update-check"))return console.log("[APP][checkForUpdate] Update check is disabed"),void $("#update-icon").remove();console.log("[APP][checkForUpdate] Start");t=t||!0;var e=$("#update-icon"),S=e.data("current_git_tag"),s=e.data("update_channel");if(e.parent().hasClass("update-now"))return console.log("[APP][checkForUpdate] NEW VERSION FOUND ALREADY"),!0;if(e.hasClass("fa-spin"))return console.log("[APP][checkForUpdate] Still searching"),!1;e.removeClass("fa-check").removeClass("fa-question").removeClass("fa-times").addClass("fa-sync").addClass("fa-spin");var a="releases/latest";"stable"!==s&&(a="releases");var o="https://api.github.com/repos/reloxx13/TasmoAdmin/"+a;$.get(o,{},(function(s){if(void 0!==s)if(Array.isArray(s)&&(s=s[0]),void 0!==s.tag_name){var a=s.tag_name;console.log("[APP][checkForUpdate] latestTag => "+a),a!==S?(console.log("[APP][checkForUpdate] NEW VERSION FOUND"),3!==s.assets.length?(console.log("[APP][checkForUpdate] Seems like Travis is not done yet"),e.removeClass("fa-sync").addClass("fa-check"),t&&setTimeout(checkForUpdate,3e5)):e.removeClass("fa-sync").removeClass("fa-spin").addClass("fa-cloud-download-alt").parent().addClass("update-now")):(console.log("[APP][checkForUpdate] No update found"),e.removeClass("fa-sync").addClass("fa-check"),t&&setTimeout(checkForUpdate,9e5))}else void 0!==s.message&&(e.removeClass("fa-sync").removeClass("fa-spin").addClass("fa-times"),console.log("[APP][checkForUpdate] Github Error => "+s.message),setTimeout(checkForUpdate,18e5));e.removeClass("fa-spin")}),"json").fail((function(t){e.removeClass("fa-sync").removeClass("fa-spin").addClass("fa-times"),console.log("[APP][checkForUpdate] Github Error => "+t.status+": "+t.responseJSON.message),setTimeout(checkForUpdate,18e5)}))}Date.prototype.addHours=function(t){return this.setHours(this.getHours()+t),this},jQuery.fn.shake=function(t,e,S){return this.each((function(){$(this).css("position","relative");for(var s=1;s<=t;s++)$(this).animate({left:-1*e},S/t/4).animate({left:e},S/t/2).animate({left:0},S/t/4)})),this};